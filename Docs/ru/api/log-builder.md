# API билдера Log (DSL) — Рекомендуется

Билдер `Log` предоставляет fluent интерфейс для построения богатых структурированных событий логирования с метаданными. Это **рекомендуемый подход** для большинства сценариев логирования в Letopis.

## Почему использовать DSL?

- **Выразительный и читаемый** — Цепочка методов для естественного построения сложных событий логирования
- **Типобезопасные метаданные** — Использование протокольных типов событий и действий
- **Богатый контекст** — Легко прикрепляйте полезные нагрузки, местоположение в коде и приоритет
- **Гибкое маскирование** — Точный контроль над чувствительными данными

## Методы

### `action(_:)`

Устанавливает семантическое действие для события.

- Принимает любой тип, соответствующий `ActionProtocol`, или строковый литерал

```swift
logger.action("user_click").info("Кнопка нажата")
```

### `event(_:)`

Устанавливает тип события.

- Принимает любой тип, соответствующий `EventTypeProtocol`, или строковый литерал

```swift
logger.event(AppEventType.userAction).info("Экран открыт")
```

### `payload(_:)`

Объединяет дополнительные пары ключ-значение в полезную нагрузку события.

```swift
logger
    .event(.apiCall)
    .payload(["endpoint": "/api/users", "method": "GET"])
    .info("Запрос API начат")
```

### `critical()`

Помечает событие как критичное, требующее немедленного внимания.

```swift
logger
    .event(.payment)
    .critical()
    .error("Сбой обработки платежа")
```

### `source(file:function:line:)`

Записывает информацию о месте вызова в полезную нагрузку. По умолчанию использует `#file`, `#function` и `#line`.

```swift
logger
    .source()
    .info("Отладочная информация с местоположением источника")
```

### `sensitive(keys:strategy:)` / `sensitive(key:strategy:)`

Применяет пользовательские стратегии маскирования к конкретным ключам в полезной нагрузке.

> **Примечание:** С ноября 2025 года маскирование **включено по умолчанию** для всех глобально настроенных конфиденциальных ключей. Этот метод используется для применения пользовательских стратегий или маскирования дополнительных ключей, не входящих в глобальный список.

```swift
// Применение пользовательских стратегий к конкретным ключам
logger
    .payload(["email": "user@example.com", "card": "1234-5678"])
    .sensitive(key: "email", strategy: .email)
    .sensitive(key: "card", strategy: .last4)
    .info("Платеж обработан")

// Маскирование нескольких ключей одной стратегией
logger
    .payload(["token": "abc123", "api_key": "xyz789"])
    .sensitive(keys: ["token", "api_key"], strategy: .full)
    .info("Аутентификация завершена")
```

### `notSensitive()`

Отключает автоматическое маскирование для этого конкретного события логирования.

> **Предупреждение:** Используйте только в разработке/отладке. Production логи должны оставлять маскирование по умолчанию включенным.

```swift
// Отключение маскирования для просмотра сырых значений при отладке
logger
    .payload(["password": "secret123", "token": "abc123"])
    .notSensitive()
    .debug("Отладка процесса аутентификации")
// Вывод: password=secret123, token=abc123 (без маскирования)
```

### Терминальные методы

Эти методы устанавливают тип события, сообщение и немедленно отправляют событие:

- `info(_:)` - Логирование информационного сообщения
- `warning(_:)` - Логирование предупреждения
- `error(_:)` или `error(_ error: Error, ...)` - Логирование ошибки
- `debug(_:)` - Логирование отладочного сообщения
- `analytics(_:)` - Логирование события аналитики

```swift
logger.event(.userAction).info("Пользователь вошел в систему")
logger.event(.system).warning("Мало памяти")
logger.event(.error).critical().error("Сбой сети")
logger.event(.debug).debug("Кеш обновлен")
logger.event(.analytics).analytics("Покупка завершена")
```

## Примеры использования

```swift
// Простой лог
logger.log().info("Приложение запущено")

// С типом события и действием
logger
    .event("user_action")
    .action("button_tap")
    .info("Пользователь нажал кнопку оформления заказа")

// Критичная ошибка с информацией об источнике
logger
    .event("payment")
    .source()
    .critical()
    .error("Таймаут платежного шлюза")

// Аналитика с данными
logger
    .event("purchase")
    .action("completed")
    .payload(["amount": "99.99", "currency": "USD"])
    .analytics("Покупка успешна")
```

---

[Назад к индексу документации](../index.md)
